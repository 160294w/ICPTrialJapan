IBM Cloud Privateは、コンテナ化アプリケーションの開発、編成、および管理を行うためのアプリケーション・プラットフォームです。
このチュートリアルでは、IBM Cloud Private重要な機能について説明します。

# IBM Cloudプライベートの概要
IBM Cloud Private（ICP）は、コンテナ化されたアプリケーションの開発、編成、および管理を行うためのアプリケーション・プラットフォームです。 
ICP トライアル版をホストすることで、kubernetesの概念、クラウドネイティブアプリケーションの展開と管理を開始するのに役立ちます。
ICPは Kubernetesのアプリケーション開発の選択肢をサポートしています。以下の利点があります。
* マイクロテナントコンテナとマイクロサービスベースのアプリケーションを作成するためのKubernetesに基づくオーケストレーション
* 開発者の生産性を高めるエンタープライズとオープンなサービスの共通カタログ
* Istio、Prometheusによる監視、ELKによるロギングなど、マイクロサービスのスケーラブルな管理をサポートする共通の基本サービス
* アプリケーションの自動水平および無停止の垂直スケーリング
* アプリケーションの隔離とセキュリティのためのネットワークとクラウドストレージポリシーベースのコントロール
* 自動化されたアプリケーション健全性チェックと障害からの回復

# 環境へのアクセス
**重要：2時間の休止後、環境は中断されます。作業を再開するには、右上隅の再生アイコンをクリックします。再起動処理には10〜15分かかります。**

1. 予約フォームを完了して数分後、予約した環境に関する指示が記載された電子メールを受信トレイで確認してください。指示に従って、インスタンスにログインします。
1. 初めて自分の環境にログインすると、VMがサスペンドされていることもあります。開始するには、右上隅の再生アイコンをクリックします。最初に環境を始動するときにIBM Cloud Privateが完全に開始されるまでには10〜15分かかります。
1. ブラウザからのアクセス：ほとんどの機能については、ブラウザからICPコンソールを起動できます。ブラウザからICPコンソールにアクセスするためのURLは確認メールで送信されます。
1. Linuxデスクトップ：Kubernetes 	cliベースのクエリや他の機能にアクセスする必要がある場合は、ICPMasterノードをクリックします。これは、ICPMasterノードのLinuxデスクトップを開きます。
このデスクトップの中から、ICPにアクセスすることができます。
コンソール：Firefoxブラウザを開き、IBMCloudPrivateConsoleブックマークをクリックします。ユーザーIDはadmin、パスワードはicp1nCl0udです。
CommandLine：ターミナルウィンドウを開き、tools / kubcli.sh <userid> <password>を実行します。その後、kubectlコマンドの実行を開始することができます

# [トライアル環境の詳細](https://github.com/ICpTrial/ICPTrialJapan/blob/master/icpoverview.md)


# ICPクラスタの詳細
トライアル環境のトポロジーは、以下から構成されます
* マスター/プロキシノード
* 2つのワーカーノード
* 1つの管理ノード
* 1つの脆弱性アドバイザー・ノード
これらのノードのさまざまなコンポーネントを以下に示します


## アーキテクチャ
このホストされた試用版は、あなたがユースケースのいくつかを検証するために使用できる製品に精通するために提供されています。ここでは、調査のために事前に展開されているサンプル・アプリケーションとオープン・サービスの一部を紹介します。
* Microclimate：アプリケーション開発と展開のための開発環境
* Microservicesサンプル：サンプルのクラウドネイティブマイクロサービスアプリケーション
* LDAPサーバー：LDAPサーバーを開いて、LDAPとのICP接続を表示する
* Prometheus と Grafana：ICPは標準的な監視とダッシュボードを提供した
* ロギング：ElasticSearch、Logstash and Kibana（ELK） -  ICPが標準的なロギングを提供
* Istio：マイクロサービスの接続、管理、セキュリティのためのオープンプラットフォーム
* Kubernetes操作ビュー：Kubernetesクラスタの操作ビュー
* Weavescope：コンテナとサービスのリアルタイムビジュアライゼーションツール

## 永続ストレージ
トライアル環境では永続ストレージにはNFSを使用できます nfsサーバーは、icpmasterノードで構成されています。 nfs共有ディレクトリは /datavolです。詳細情報永続的ストレージ
製品ドキュメント
ICP concoleのドキュメントリンクをクリックすると、コンテキストのドキュメントにアクセスできます。


# Mircoclimate 

Microclimateはエンドツーエンドの開発環境で、アプリケーションの作成、編集、および展開を迅速に行うことができます。アプリケーションはコンテナで実行され、Jenkinsを使用して自動化されたDevOpsパイプラインを通じてICP環境に配信できます。これはすでにICPにインストールされており、現在Java、Node.js、およびSwiftをサポートしています。
いくつかの機能は次のとおりです。
* コンテナ化された開発：生産環境に合わせて簡単に再現可能な軽量コンテナを使用して、最初から開始
* 迅速なイテレーション：雷を素早く、編集、ビルド、および実行することで、開発フェーズに関係なく、リアルタイムでパフォーマンスの洞察を得ることができます。
* インテリジェント・フィードバック：アプリケーションを改善するためのベストプラクティスと即時フィードバック。
* 診断サービス：開発時に機能を追加して、本番環境における問題判別を改善します。
* 統合されたDevOpsパイプライン：お客様のニーズに合わせて事前設定されたDevOpsパイプラインを使用して、迅速に運用を開始できます。

## Micoclimateへのアクセス方法
icpmasterノードの試用版のLinuxデスクトップでfirefoxブラウザを開き、Microclimateブックマークをクリックします。
または、ブラウザの新しいタブで、URL https://microclimate.10.0.0.1.nip.ioを使用します。
HowTosへのリンクは次のとおりです
* Mricorliamteを使う
* プロジェクトのインポート
* パイプラインの使用
* サンプルアプリケーション


# サンプルマイクロサービスアプリケーション

サンプルマイクロサービスアプリケーション、stocktraderは、この環境に既にデプロイされています。このアプリケーションは、ローカルデータベース、メッセージングのキューマネージャー、ローカルキャッシュ、パブリッククラウドとの統合を使用して、真のハイブリッド方式で株式相場を取得します。ローカルデータベース用にコンテナ化されたIBM DB2を導入しました。同様に、メッセージング用にIBM MQを、ローカル・キャッシュ用にRedisを導入しました。アプリケーションアーキテクチャは、アプリケーションのさまざまなコンポーネントを示しています。

##アプリケーションアーキテクチャ
ポートフォリオに在庫を追加すると、Stock Quoteマイクロサービスに連絡が取られます。 Redisをチェックして、24時間以内にローカルキャッシュがあるかどうかを確認し、そうでなければquandl.comに接続して最新の株価を取得します。ポートフォリオが更新されると、ユーザが次のレベルに達したかどうかを計算するロイヤルティレベルのマイクロサービスにコンタクトする。ユーザーID、パスワードトレーダを持つ在庫は、アプリケーションの認証に使用されます。アプリケーションは以下の機能を提供します
新しいポートフォリオを作成する
選択したポートフォリオを取得する
選択したポートフォリオを更新
選択したポートフォリオを削除
FirefoxのブラウザでStockTraderブックマークをクリックすると、アプリケーションにアクセスできます。

# LDAPとの統合
Openldapサーバは環境に配備され、LDAP認証を提供するために使用されます。 ldapサーバーには、サンプルユーザーとグループがほとんどありませんでした。このシナリオでは、ldapサーバーをICPに接続し、ldapサーバーのユーザー/グループを追加して役割ベースのアクセスを実現します。 LDAPサーバーのサンプルユーザーとグループは、次のとおりです。
￼
 <source srcset = "https://ibm-dte.mybluemix.net/images/tutorials/cloud-private-trial/ldapgroupsandusers.webp" type = "image / webp"> <source srcset = "https：// ibm- dte.mybluemix.net/images/tutorials/cloud-private-trial/ldapgroupsandusers.png "type =" image / png "> <img src =" https://ibm-dte.mybluemix.net/images/tutorials/cloud -private-trial / ldapgroupsandusers.png "alt =" LDAPGroups＆amp; Users ">
上記のすべてのユーザーのパスワードはicp1nCl0udです。

## ICPとLDAPサーバーを接続する
1. ldapサーバーとICPを接続するには、LDAPサーバーのアドレス、ベースドメイン、バインドユーザーID、バインドユーザーパスワード、ユーザーとグループのフィルターが必要です。
1. kubectlを実行できるコマンドウィンドウを起動します。
1. コマンドkubectl -n services svcを実行します。 grep myopenldapを実行して、ClusterIP 10.1.0.248kubectl -n services get svc | grep myopenldap
* myopenldap ClusterIP 10.1.0.248 <なし> 389 / TCP、636 / TCP 1h
*
1. 同様に、以下のようにコマンドを実行し、LDAP管理者のパスワードを書き留めておきます。kubectl get secret --namespace services myopenldap -o jsonpath = "{。data.LDAP_ADMIN_PASSWORD}" | base64  - デコード;エコー
* Si6O0hwBobyOoVBKoMnszIMedKRye39w
*
1. 以下の情報を使用して、ldapサーバーとICPクラスターを接続します。 ICPコンソールのナビゲーションメニュー - >管理 - >認証、LDAP接続を追加します。名前：OpenldapType：CustomBase DN：dc = bluedemos、dc = comBind DN：cn = admin、dc = bluedemos、dc = comAdminパスワード：Si6O0hwBobyOoVBKoMnszIMedKRye39wURL：ldap：//10.1.0.248：389
1. [接続テスト]ボタンをクリックします。接続が正しい場合は、LDAP接続が成功したというメッセージが表示されます。
1. 同様に、グループとユーザーのフィルタとグループとユーザーのマッピングには次の値を使用します
グループフィルタ：（＆（cn =％v）（objectclass = groupOfUniqueNames））ユーザフィルタ：（＆（cn =％v）（objectclass = inetOrgPerson））グループIDマップ：*：cnユーザIDマップ：*：cnグループメンバーIDマップ：groupOfUniqueNames：uniqueMember

## ユーザーロール
ICPはさまざまな役割をサポートしています。ユーザーに関連付けられたロールは、実行できるアクションを決定します。様々な役割があった
クラスタ管理者、管理者、オペレータ、エディタ、icpviewer
各ロールの詳細については、IBM Knowledgecenterを参照してください。

## グループを作成してLDAPでグループに関連付ける
チーム内のすべてのユーザーは、チームに関連付けられたリソースにアクセスできます。ユーザー、ユーザーグループ、リソースを複数のチームに関連付けることができます。次の手順を実行してチームを作成します。
1. ユーザーadminとしてICPコンソールにログインする
ナビゲーションメニュー - >管理 - >チーム

## チームにリソースを追加する
チームにリソースを追加する必要があります。チームメンバーは、チームに追加されたリソースだけにアクセスできます。
ユーザーadminとしてICPコンソールにログインする
ナビゲーションメニュー - >管理 - >チーム
team blueadminsをクリックしてください
[リソース]タブをクリックします。
[リソースを追加]ボタンをクリックします。
デフォルトのリソース、googlestable、ibm-charts、ibm-charts-public、local-charts、stocktrader、weaveを選択し、「追加」ボタンをクリックします。
リソースとリソースタイプは次のように表示されます

## 新規ユーザーでテストする
これで、追加されたユーザーとのログインがテストされます。
パスワードicp1nCl0udのユーザーicpadmin1としてログインする
このユーザーに関連付けられたリソースを確認します。
このユーザーは管理者の役割を持つので、ユーザーは
チームの作成
他のチームにリソースを割り当てる
チームのためのリソースを作成する
チームのユーザー、グループ、ロールを管理する
チームのリソースの読み取り、更新、および削除
他のロールと同様にテストします。

# モニタリング
ICPクラスタ監視ダッシュボードを使用して、クラスタとアプリケーションのステータスを監視できます。監視ダッシュボードでは、PrometheusとGrafanaを使用して、クラスタノードとコンテナに関する詳細なデータを表示します


プロメテウスは、元々SoundCloudで構築されたオープンソースのシステム監視とアラートツールキットです。プロメテウスは、Kubernetesの後の第2のホストプロジェクトとして2016年にCNCFに加わりました。ほとんどのPrometheusコンポーネントはGoで書かれており、静的なバイナリとして簡単にビルドおよびデプロイできます。プロメテウスの成分は
1. プロメテウスのサーバーはターゲットを監視し、ターゲットはHTTP、HTTPS、DNS、TCP、ICMP（* Black-Box Exporter）経由の任意のエンドポイントであるか、またはプロメテウスのサーバーがアプリケーションの状態を取得するアプリケーションが公開する単純なHTTPエンドポイント。特定のターゲットからのメトリックを収集し、atime-seriesデータベースに格納するために定義した間隔でPrometheusサーバーのクラスターゲットを作成し、PromQLというクエリ言語を使用してターゲットに関するメトリックをクエリします。
1. Alert Managerはアラートを取り込み、それらをグループに集約し、重複排除し、無音を適用し、スロットルし、電子メール、Pagerduty、Slackなどに通知を送信します。
1. Exporterは、サードパーティのシステムから既存のメトリックを取得し、Prometheusサーバーが理解できるメトリック形式にエクスポートするソフトウェアです。
1. Grafanaは、Prometheusデータベースに格納されているメトリックを視覚化する視覚化レイヤーです。 Prometheusサーバーに直接PromQLクエリを書く代わりに、Grafana UIボードを使用してPrometheusサーバーからメトリックをクエリし、Grafana Dashboardで視覚化することができます。ダッシュボードにアクセスするには、ブラウザで新しいタブを開き、Grafanaのブックマークをクリックします

次のダッシュボードは製品とともに事前に展開されています。
* ドッカーのホストとコンテナの概要
* 弾性検索
* プロメテウスによるその他
* ICP 2.1名前空間パフォーマンスIBM提供2.5
* ICP 2.1パフォーマンスIBM提供2.5
* Kubernetesクラスタ監視（Prometheus経由）
* プロメテウスの統計

# ロギング
ICPロギングでは、ロギングにElastic Search、Logging、Kibana（ELK）スタックを使用します。より多くのユーザーELKスタックをカタログから展開し、構成することができます。インストールされたELKスタックは、KubernetesとDockerを含むICP管理サービスのシステムログを収集します。デフォルトのELKスタックとFilebeatデーモン・セットは、デプロイされているコンテナ・ログを収集します。 ICPは、展開されるELKスタックの数を制限しません。

## ELKアーキテクチャ
* Elasticcsearchは、ELKスタック上のインデックス、ストア、およびクエリアプリケーションです。 Logstashで処理されるログファイルレコードの標準的な全文検索機能を提供します。 ELKオンラインヘルプドキュメントでは、Elasticsearchについて次のように説明しています。「一般的に、複雑な検索機能と要件を持つアプリケーションに役立つ基本的なエンジン/テクノロジとして使用されています。
* Logstashは、ELKスタックがログファイルレコードの収集、変換、および転送を管理できるようにするアプリケーションです。 Logstashは、リモートソースからレコードを取得したり、指定されたポート上のレコードをリスンすることができます。
* Kibana は、検索結果を視覚化し、検索に基づいてチャートやダッシュボードを作成できるように、エラーサーチと統合するユーザーインターフェイスです。検索、チャート、およびダッシュボードは、リアルタイムまたは履歴ログ記録を視覚化することができます。ロギングダッシュボードにアクセスするには、ブラウザで新しいタブを開き、「Kibana」ブックマークをクリックします

# Istio
IBM、Google、Lyftの共同作業であるIstioは、マイクロサービス自体を変更することなく、複雑なタスクの多くを自動的に管理するサービスメッシュを簡単に作成する方法を提供します。 Istioはこれを行います：
ネットワーク・インフラストラクチャー全体を管理し、devopsチームによって定義されたポリシーおよびトラフィック・ルールを適用するコントロール・プレーンをデプロイする
「サイドカー」を含むデータ・プレーンを配置する。マイクロ・サービスの各インスタンスの側面に沿って配置され、すべての着信および発信ネットワーク・トラフィックを傍受するためのプロキシとして機能するセカンダリ・コンテナ。サイドカーは、オープンソースのエッジプロキシであるEnvoyを使用して実装されています
この環境では、bookinfoサンプルが事前にデプロイされています。サンプルアプリケーションbookinfoは、Istio-Bookinfoサンプルブックマークをクリックするとアクセスできます
詳細は
あなたのマイクロサービスのためのトラフィック管理

# Kubernetes操作ビュー
Kubernetesのオペラティブビューは、次のように機能を提供します
ノードをレンダリングし、その全体的な状態を示す（「準備完了」）
ノード容量とリソース使用率（CPU、メモリ）を表示
CPUごとに1つの「ボックス」をレンダリングし、ポッドCPUの要求/使用量の合計
合計メモリの垂直バーをレンダリングし、ポッドメモリの要求/使用量の合計
個々のポッドをレンダリングする
ポッドの状態を境界線の色（緑：実行可能/実行中、黄色：保留中、赤：エラーなど）で示します。
小さな縦棒で現在のCPU /メモリ使用量を表示する（Heapsterから収集）
システムポッド（「kube-system」名前空間）は、一番下にグループ化されます
ノードとポッドのツールチップ情報を提供する
ポッドの作成と終了をアニメートする
Kubernetes運用ビューはこの試用版に配備されており、
ブラウザで新しいタブを開き、KubeOpsViewブックマークをクリックしてください
または、ナビゲーションメニューから起動 - >ワークロード - >デプロイメント - > mykube-view-kube-ops-viewをクリックして起動することもできます

# ウィーブスコープ
WeavescopeはDockerとKubernetesのための可視化と監視のツールです。アプリやインフラストラクチャ全体をトップダウン表示して、分散型コンテナ化されたアプリの問題をリアルタイムで診断することができます。 weavescopeの機能のいくつかは、
Dockerコンテナをリアルタイムで理解する：コンテナインフラストラクチャの概要を選択するか、特定のマイクロサービスに焦点を当てます。問題を簡単に特定して修正して、コンテナ化されたアプリケーションの安定性とパフォーマンスを保証します。
コンテキストの詳細とディープリンク：コンテナのコンテキストメトリック、タグ、およびメタデータを表示します。コンテナ内のプロセス間を簡単にナビゲートして、コンテナを実行し、展開可能なソート可能なテーブルに配置します。特定のホストまたはサービスに最も多くのCPUまたはメモリを使用して、コンテナを簡単に見つけることができます。
コンテナと対話し、管理する：コンテナを直接操作する：コンテナを一時停止、再起動、および停止する。コマンドラインを起動します。スコープブラウザのウィンドウを離れることなくすべて。
Weavescopeはこの試用版に配備されており、
ブラウザで新しいタブを開き、Weavescopeのブックマークをクリックします。
または、ナビゲーションメニューから起動 - >ワークロード - >デプロイメント - > weave-scope-appをクリックして起動することもできます

# Linuxネットアプリケーションのサンプル
サンプルASP.Netアプリケーションがこの試用版に導入されました。任意のASP.NetアプリケーションをICPクラスタに展開できることを示すdotNetサンプルアプリケーションです。
ASP.Netにアクセスできる
ブラウザで新しいタブを開き、ASP.Netブックマークをクリックします。
または、ナビゲーションメニューから起動 - >ワークロード - >デプロイメント - > kube-dotnetをクリックして起動することもできます

# ICP Community Support
ICP Public Slack Channel
Stackoverflow

# まとめ
IBM Cloud Private Trialチュートリアル：IBM Cloud Private Hosted Trialを完了しました。このチュートリアルでは、ICPのさまざまな機能に精通し、クラウドネイティブアプリケーションを迅速に構築して展開する方法について説明しました。あなたは13のタスクを完了することでこれを行いました：
1. 環境へのアクセス
1. 概要 -  IBM Cloudプライベート
1. ICPクラスタの詳細
1. 微気候
1. サンプルマイクロサービスアプリケーション
1.  LDAPとの統合
1.  モニタリング
1.  ロギング
1.  Istio
1. Kubernetes操作ビュー
1. ウィーブスコープ
1. サンプルlinux.Netアプリケーション
1. ICPコミュニティサポート

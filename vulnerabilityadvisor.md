# 脆弱性アドバイザー

脆弱性アドバイザーは、コンテナーの脆弱性評価を行います。
以下の2つを対象としたセキュリティー脆弱性評価を行うことができます。
- ICPのプライベート・レジストリーに保管されたイメージ
- ICP上で実行中のコンテナー

## 脆弱性アドバイザー・コンソールの表示
1. 脆弱性アドバイザー・コンソールは、ICPVAノードで稼働しており、Hostedデモ環境では、各自のPCのブラウザーからはアクセスできません。MasterノードのVMインスタンスのLinux Desktopにアクセスして、firefoxブラウザーを起動し、ICPコンソールにアクセスします。画面上部の「Fit to Window」ボタンをクリックして、firefoxブラウザーを拡大して、操作することをお勧めします。
1. ICPコンソールにログインし、ナビゲーション・メニューから、Platform > Vulnerablity Advisor をクリックします。
1. ネームスペースの一覧が表示されますので、脆弱性評価を確認するネームスペースのハイパーリンクをクリックします。ここでは、例として「stocktrader」のハイパーリンクをクリックします。
1. 新規のブラウザー・タブがオープンし、脆弱性アドバイザーのコンソールが表示されます。
    1. 初回アクセス時には、"Your connection is not secure"と警告画面が表示されます。「Advanced」ボタンをクリックし、「Add Exception...」ボタンをクリックし、ポップアップ・ウィンドウの「Confirm Security Exception」ボタンをクリックします。
    1. 再度、ICPコンソールのログイン時に表示されるログイン画面が表示されます。ICPコンソールのログインID(admin/icp1nCl0ud)で、ログインします。
    1. ICPコンソールのダッシュボードが表示される場合には、再度、ナビゲーション・メニューから、Platform > Vulnerablity Advisor をクリックし、「stocktrader」のハイパーリンクをクリックしてください。
  <br>![VAConsole](https://github.com/ICpTrial/ICPTrialJapan/blob/master/VA/pics/VA010_console.png)
1. 脆弱性アドバイザー・コンソールのトップ・ページで、選択された名前空間内のコンテナーおよびイメージが一覧表示され、脆弱性診断のサマリーが表示されます。一覧には、各コンテナーまたはイメージに関する以下の情報が表示されます。

    |列名|説明|
    |:---|:---|
    | 名前 (Name) | コンテナーまたはイメージの名前|
    |所有者 (Owner) | コンテナーまたはイメージが属する名前空間|
    |クロール時刻 (Crawled Time) | コンテナーまたはイメージがスキャンされたタイム・スタンプ|
    |タイプ (Type) | オブジェクトがコンテナーまたはイメージのいずれであるか|
    |組織のポリシー (Organizational Policies) | 適用されているセキュリティー・ポリシー。 これは、後述する「ポリシーの管理 (Managing Policies)」ページで設定します。|
    |脆弱パッケージ (Vulnerable Packages) | コンテナーまたはイメージで特定された脆弱性を含むパッケージの数|
    |コンテナー設定 (Container Settings) | 潜在的なセキュリティーおよびコンプライアンス上の問題を含むコンテナー設定の数|

## セキュリティー・レポート (脆弱性診断レポート)の確認
特定のコンテナー・インスタンス(または、イメージ)の脆弱性診断レポートの詳細を確認します。
1. 組織のポリシー (Organizational Policies) カラムなどの値が、赤文字で表記され、脆弱性が指摘されている「stocktrader/portfolio-・・・」のハイパーリンクをクリックします。
<br>![SelcetContainer](https://github.com/ICpTrial/ICPTrialJapan/blob/master/VA/pics/VA020_ViolatedContainer.png)
1. 選択したコンテナー・インスタンスの診断結果の詳細が表示されます。「Organizational Policies」、「Vulnerable Packages」、「Container Settings」、「Risk Analysis」の4つのタブから構成される画面が表示されます。
<br>![ContainerDetail](https://github.com/ICpTrial/ICPTrialJapan/blob/master/VA/pics/VA030_Detail01.png)
1. 最初に表示される「Organizational Policies」タブでは、組織のポリシーで指定した個々のポリシーへの準拠状況が、「Passed」、「Violation」、「Incomplete」のいずれかで表示されます。例えば、脆弱性を含むパッケージの検出ポリシーを指定した場合に、診断対象のOSではなかったときに、「Incomplete」の準拠状況の表示になります。
1. 「Vulnerable Packages」タブを選択します。
<by>![SelectValPack](https://github.com/ICpTrial/ICPTrialJapan/blob/master/VA/pics/VA040_SelectVulPackTab.png)
1. 脆弱性を含むパッケージの一覧が表示され、各パッケージの、脆弱性の説明、修正アクションが表示されます。また、オペレーティング・システム・ディストリビューターの通知がある場合は、「Security Notice」カラムのハイパーリンクをクリックすることで、脆弱性の詳細を確認することができます。
<br>![ValPackList](https://github.com/ICpTrial/ICPTrialJapan/blob/master/VA/pics/VA050_ValPackList.png)
1. 「Container Settings」タブを選択します。コンテナー設定のセキュリティー準拠状況が一覧表示されます。
<br>![ContainerSetList](https://github.com/ICpTrial/ICPTrialJapan/blob/master/VA/pics/VA060_ContSettingList.png)
1. 「Risk Analysis」タブを選択します。CVSSの脆弱性Rateに基づき、該当イメージとコンテナーの脆弱性の中で、もっとも高Rateの脆弱性について、リスクの内容やリスク度合いを色分けして表示するリスク分析結果が表示されます。
<br>![RiskAnalysis](https://github.com/ICpTrial/ICPTrialJapan/blob/master/VA/pics/VA070_RiskAnalysis.png)

## セキュリティー・ポリシーの設定
脆弱性診断を行う基準となるセキュリティー・ポリシーの設定画面を確認します。設定を変更することもできます。
1. 画面上部の黒帯のタブ領域の「Manage Policies」タブを選択します。
<br>![SelcetManagePolicy](https://github.com/ICpTrial/ICPTrialJapan/blob/master/VA/pics/VA080_SeclectManagePoliciesTab.png)
1. ポリシーの設定確認や変更を行う画面が表示されます。診断するルールのONとOFFを切り替えることで、設定を変更できます。
<br>![ManagePolicy](https://github.com/ICpTrial/ICPTrialJapan/blob/master/VA/pics/VA090_MngPolicies.png)
1. 設定変更を反映するには、Default Policyの枠の最下部にある「Submit Policy」ボタンをクリックします。
<br>![SubmitPolicyChange](https://github.com/ICpTrial/ICPTrialJapan/blob/master/VA/pics/VA100_SubmitPolicy.png)

## 脆弱性アドバイザーの補足情報
このハンズオンでは、触れていませんが、下記の情報については、参考リンクのKnowledge Centerを参照ください。
- 脆弱性アドバイザーのインストール(セットアップ)
- イメージとコンテナーそれぞれの診断の有効化/無効化の設定
- 診断(スキャン)間隔の設定
- 診断結果レポートの保管期間の設定

<br>参考リンク)<br>
ICP 2.1 Knowledge Center「脆弱性アドバイザー」<br>
https://www.ibm.com/support/knowledgecenter/ja/SSBS6K_2.1.0.3/manage_cluster/vuln_advisor.html

